# Лекция
1. Характеристика языка C: компилируемый, со статической типизацией, более низкоуровневый чем Python.
2. Основы синтаксиса. Сравнение с Python.
    - Структура программы. Вложенность и операторные скобки. ;
    - Компиляция. Структура проекта в Visual Studio.
    - Типы. Объявление переменных. Целочисленные выражения. Строковый и символьный типы. 
    - Подключение библиотек.
    - Ввод и вывод.
    - Управляющие операторы. if, swicth, for, while, do while.
    - Статические массивы. Двумерные массивы.
    - Функции. Передача по ссылке и по указателю.
    - Файлы. 

# Создание проекта на C в Visual Studio 2022

Visual Studio не предоставляет специальных шаблонов проекта для языка C, однако за основу можно взять проект на C++:

1. Создать пустой проект (Empty Project) на C++ для консоли
2. Добавить основной файл исходных кодов:
    - В окне обозревателя решений, кликнуть правой кнопкой мыши на названии проекта (на рис. проект называется c_lab )
    - В контекстном меню выбрать: Добавить > Создать элемент... > C++ файл
    - В появившемся окне добавления задать имя файла с расширением `.c`, например `main.c`

<img src="assets\VS_add_file.png" width=700>

3. В добавленном файле исходных кодов описать минимальную программу на языке C:

```c
  /// Главная функция программы
  int main() {

  }
```

4. Скомпилировать и запустить программу ( Ctrl + F5 )


Языки С и С++ во многом похожи, у них много общего в синтаксисе и в стандартных библиотеках. Однако есть и отличия. Если файл исходных кодов имеет расширение `c`, не `сpp` то Visual Studio будет воспринимать его как исходный код именно на C, не C++.

Например если в такой программе использовать ключевые слова (например `class`), то компиляция завершится с ошибкой.


# Hello, World!
Простая программа на C.
```c
// подключение (вставка) модуля для ввода и вывода
#include <stdio.h>

/// Главная функция программы
int main() {

	// вывод строки на экран
	printf("Hello, World!");


  return 0;
  // код возврата для ОС, принято что код возврата 0 означает, что программа завершилась без ошибок.
}
```
# Некоторые типы данных
В C размеры некоторых типов зависят от реализации. Типичные размеры:
```c
    // #include <limits.h>
    printf("char   %lu байт    от %22d до %22d\n", sizeof(char),       CHAR_MIN, CHAR_MAX);
    printf("short  %lu байт    от %22d до %22d\n", sizeof(short),      SHRT_MIN, SHRT_MAX);
    printf("int    %lu байт    от %22d до %22d\n", sizeof(int),        INT_MIN,  INT_MAX);
    printf("long   %lu байт    от %22li до %22li\n", sizeof(long),     LONG_MIN, LONG_MAX);

    // #include <float.h>
    printf("float  %lu байт    от %22e до %22e  с точностью %e\n",   sizeof(float),      FLT_MIN,  FLT_MAX, FLT_EPSILON);
    printf("float  %lu байт    от %22e до %22e  с точностью %e\n",   sizeof(double ),    DBL_MIN,  DBL_MAX, DBL_EPSILON);
```

```
char   1 байт    от                   -128 до                    127
short  2 байт    от                 -32768 до                  32767
int    4 байт    от            -2147483648 до             2147483647
long   8 байт    от   -9223372036854775808 до    9223372036854775807
float  4 байт    от           1.175494e-38 до           3.402823e+38  с точностью 1.192093e-07
float  8 байт    от          2.225074e-308 до          1.797693e+308  с точностью 2.220446e-16
```
`1.175494e-38` — экспоненциальная запись, означает число $1.175494 \cdot 10^{-38}$

Если к имени типа добавить `unsigned`, то его диапазон значений сместится в положительную область, начиная с нуля. Например `unsigned char` принимает значения от 0 до 255.
# Пример: ввод, вывод, вычисления
```c
#include <stdio.h>
#include <math.h>       // математический модуль
/* Автор: Иванов И.И.
 * Задача
 * Вычислить стоимость товара ценой s0, через t лет, если инфляция каждый год составляет p процентов
 */
int main() {

    // объявление и инициализация (задание начального значения) переменных
    // рекомендуется объявлять основные переменные в начале главной функции, если не требуется обратного
    float s0 = 0, s = 0;    // начальная цена, конечная цена
    unsigned t = 0;         // количество лет
    float p = 0;            // инфляция в процентах

    // вывод пояснения для пользователя
    printf("Вычислить стоимость товара ценой s0, через t лет, если инфляция каждый год составляет p процентов\n");
    // \n - обозначение символа перехода на новую строку
    printf("s0 = ");
    // считывания введённого значения в переменную s0, ожидается что пользователь введёт вещественное число ("%f")
    scanf( "%f", &s0 );
    // &s0 означает, что в функцию передаётся не значение переменной, а её адрес.
    // таким образом функция сможет изменить значение указанной переменной.

    printf("t = ");
    // считывания введённого значения в переменную s0, ожидается что пользователь введёт вещественное число ("%f")
    scanf( "%u", &t );

    printf("p = ");
    // считывания введённого значения в переменную s0, ожидается что пользователь введёт вещественное число ("%f")
    scanf( "%f", &p );

    // определим цену по формуле сложных процентов
    s = s0 * pow( 1 + p/100, t * 1);

    printf("Новая цена: %5.2f", s);
    // %5.2f -- формат вывода вещественного числа: 5 позиций на всё число, 2 знака после запятой

    return 0;
}
```
- [2], Глава 4, Исследование и эксплуатация функций `printf` и `scanf`.
- справка по математическим функциям https://en.cppreference.com/w/c/numeric/math
- справка по стандартным модулям https://en.cppreference.com/w/c/header
- числовые типы данных https://en.cppreference.com/w/c/language/arithmetic_types
- на случай, если возникают ошибки компиляции при обращении к математическим функциям  https://stackoverflow.com/questions/12824134/undefined-reference-to-pow-in-c-despite-including-math-h


**Некоторые спецификаторы для функций printf и scanf**\\
```
%d, %i	int
%lu	unsigned long
%f	float
%e	float, экспоненциальная запись
```

# Пример: условный оператор
```c
#include <stdio.h>
#include <math.h>       // математический модуль

/* Автор:
 * Задача: https://ivtipm.github.io/Programming/Glava02/index02.htm#z59
 * Условие изменено: Определить, принадлежит ли точка закрашенной области ( окружность с центром в точке (1.2, 2.7) радиусом 5)
 */

int main() {

    float x0 = 1.2, y0 = 2.7;     // координаты центра окружности
    float r0 = 5.0;                // радиус окружности

    float x, y;             // координаты проверяемой точки
    float r;                // расстояние от данной точки, до центра окружности

    printf("Рассматривается окружность радиусом %2.2f с центром (%4.2f, %4.2f)\n", r0, x0, y0);
    printf("Введите координаты точки\n");

    printf("x = ");
    scanf("%f", &x);
    printf("y = ");
    scanf("%f", &y);

    // если точка принадлежит окружности, то расстояние между точкой и центром этой окружности будет не больше радиуса окружности
    // вычислим расстояние
    r = sqrt( pow(x-x0,2) + pow(y-y0,2) );      // sqrt - квадратный корень

    if ( r <= r0 )
        printf("точка принадлежит окружности");
    else
        printf("точка НЕ принадлежит окружности");
    return 0;
}
```

# Пример: циклы
```c
#include <stdio.h>
#include <math.h>       // математический модуль
/*
 * Автор:
 * Задача: Дано натуральное число n. Вычислить: 1/1 + 1/2 + 1/4 + ... + 1/(2^n)
 */

int main() {

    double sum = 0;      // для сохранения суммы
    double frac = 0;     // для хранения текущего слагаемого
    // выбран тип double, а не float потому, что в задаче придётся различать небольшие по модулю числа
    unsigned n = 0;

    printf("Заходит n математиков в бар. Нулевой математик заказывает литр пива, первый половину литра, третий четверть литра, .... \n");
    printf("n = \n");
    scanf("%u", &n);

    // каждое следующее слагаемое меньше предыдущего в 2 раза
    frac = 1;
    for (unsigned i = 0; i <= n; i++) {
        sum = sum + frac;
        frac = frac / 2.0;
    }

    printf("а бармен им говорит: вот вам %12.10f литров пива на всех", sum);

    return 0;
}

// справка по типам данных
// https://en.wikipedia.org/wiki/C_data_types
```

# Пример: массивы
```c
#include <stdio.h>
#include <math.h>       // математический модуль
#include <stdlib.h>
#include <time.h>

/*
 * Автор:
 * Задача: Даны натуральное число n, действительные числа a1,...,an.
 * Получить максимум из квадратов элементов: max (a1^2,...,an^2)
 */

int main() {

    srand( time( NULL) );                 // инициализация генератора случайных чисел текущим временем в секундах

    const unsigned N = 1024;        // максимальный размер массива
    float a[N];

    unsigned n = 0;

    printf("Даны натуральное число n (n < %d), действительные числа a1,...,an.\n", N);
    printf("Получить максимум из квадратов элементов: max (a1^2,...,an^2)\n");
    printf("Задайте количество элементов массива ( < %d)\n",N);
    scanf("%u", &n);

    // заполнение массива случайными числами от -100 до 100 включительно
    for (unsigned i = 0; i < n; ++i) {
        a[i] = 1.0 * rand() / RAND_MAX * 200 - 100;
        // домножение на 1.0 нужно для того, чтобы выражение вычислялось по правилам вещественной арифметики,
        // не целочисленной
        // rand() возвращает случайное челое число от 0 до RAND_MAX
    }


    printf("Исходные значения:\n");
    // вывод значений на экран в отдельном цикле, т.к. его в дальнейшем будет проще перенести в отдельную функцию
    for (unsigned i = 0; i < n; ++i) {
        printf( "%5.2f  ",a[i]);
        // todo: можно добавить условие для перехода на новую строку после вывода 10 элементов
        // так читать выведенные значения будет удобнее
    }

    printf("\n");

    // инициализируем начальное значение первым элементом из последовательности
    float max = a[0]*a[0];

    // поиск максимального квадрата
    for (unsigned i = 1; i < n; ++i)
        if ( a[i]*a[i] > max)
            max = a[i]*a[i];


    printf("max (a1^2,...,an^2) = %6.2f\n", max);
    printf("Это квадрат модуля числа  %5.2f\n", sqrt(max));     // для удобства проверки

    return 0;
}


// справка по модулю time http://cppstudio.com/cat/309/326/
// справка по функции rand https://ru.cppreference.com/w/c/numeric/random/rand
```

- [2], Глава 10, Массивы

# Пример: вложенные циклы

# Пример: функции
```c
#include <stdio.h>
#include <math.h>       // математический модуль
#include <stdlib.h>
#include <time.h>

/*
 * Автор:
 * Задача: Даны натуральное число n, действительные числа a1,...,an.
 * Получить максимум из квадратов элементов: max (a1^2,...,an^2)
 * Разбить задачу на функции.
 */


// Каждая функция должна быть снабжена документирующим комментарием, описывающим её назначение, параметры и возвращаемое значение, если оно есть
// Такие комментарии обычно приводят сразу перед самой функций.
// Стоит избегать использования глобальных переменных в функциях.
// Каждая функция должна отвечать за решение только одной задачи, например только вывод массива, но не заполнение и вывод массива

/// находит наибольший квадрат из всех квадратов элементов массива arr размером size
float array_max(float *arr, unsigned size){
    // arr, size - формальные параметры;
    // arr передаётся как указатель на начало массива, size по значению
    // в параметрах функций объявление float *arr и объявление float arr[] равнозначно
    float m = arr[0]*arr[0];
    for (unsigned i = 1; i < size; ++i)
        if ( arr[i]*arr[i] > m)
            m = arr[i]*arr[i];
            // todo: оптимизировать, чтобы не вычислять квадрат дважды

    return m;
}

int main() {

    srand( time( NULL) );                 // инициализация генератора случайных чисел текущим временем в секундах

    const unsigned N = 1024;        // максимальный размер массива
    float a[N];

    unsigned n = 0;

    printf("Даны натуральное число n (n < %d), действительные числа a1,...,an.\n", N);
    printf("Получить максимум из квадратов элементов: max (a1^2,...,an^2)\n");
    printf("Задайте количество элементов массива ( < %d)\n",N);
    scanf("%u", &n);

    // todo: вынести алгоритм заполнения массива в функцию
    // заполнение массива случайными числами от -100 до 100 включительно
    for (unsigned i = 0; i < n; ++i) {
        a[i] = 1.0 * rand() / RAND_MAX * 200 - 100;
        // домножение на 1.0 нужно для того, чтобы выражение вычислялось по правилам вещественной арифметики,
        // не целочисленной
        // rand() возвращает случайное челое число от 0 до RAND_MAX
    }


    printf("Исходные значения:\n");
    // todo: вынести алгоритм вывода массива в функцию
    // вывод значений на экран в отдельном цикле, т.к. его в дальнейшем будет проще перенести в отдельную функцию
    for (unsigned i = 0; i < n; ++i) {
        printf( "%5.2f  ",a[i]);
        // todo: можно добавить условие для перехода на новую строку после вывода 10 элементов
        // так читать выведенные значения будет удобнее
    }

    printf("\n");

    // вызов функции
    float max = array_max(a, n);
    // a, n - фактические параметры;
    // каждый из них должен типом совпадать с типом соответствующего формального параметра

    printf("max (a1^2,...,an^2) = %6.2f\n", max);
    printf("Это квадрат модуля числа  %5.2f\n", sqrt(max));     // для удобства проверки

    return 0;
}

```

- [2], Глава 9. Функции

# Пример: матрицы
```c
#include <stdio.h>
#include <stdlib.h>
#include <time.h>

/*
 * Автор:
 * Задача: Найти максимальное число в матрице размера n на m
 */

const unsigned N = 1024;        // максимальное число строк матрицы
const unsigned M = 1024;        // максимальное число столбцов матрицы

/// возвращает максимальное значение в двумерном массиве (матрице) mat из n строк и m столбцов
float matr_max(float mat[N][M], unsigned n, unsigned m){
    // float mat[N][M] - двумерный массив, размер массива является частью типа данных поэтому передаваемый массив должен иметь такой же размер
    // объявления без указания количества элементов в строке (float mat[][] или float **mat) невозможны,
    // т.к. непонятно сколько эл-в нужно пропустить чтобы перейти к следующей строке, но можно указывать только кол-во элементов в строке float mat[][M]
    float max_val = mat[0][0];
    for (unsigned i = 0; i < n; ++i)        // цикл по строкам
        for (unsigned j = 0; j < m; ++j)        // цикл по столбцам
            if ( mat[i][j] > max_val)
                max_val = mat[i][j];
    return max_val;
}


int main() {

    srand( time( NULL) );                 // инициализация генератора случайных чисел текущим временем в секундах

    // статический массив (размер известен ещё до компиляции);
    // причем размер массива здесь - часть типа данных, нельзя передать двумерный массив вместо другого двумерного массива с другим размером
    float matrix[N][M];             // матрица - двумерный массив

    // фактически используемое количество строк и столбцов
    unsigned n = 0, m = 0;

    printf("Найти максимальное значение в матрице\n");
    printf("Задайте количество строк матрицы ( < %d)\n",N);
    scanf("%u", &n);
    printf("Задайте количество столбцов матрицы ( < %d)\n",M);
    scanf("%u", &m);

    // todo: вынести алгоритм заполнения в функцию
    // заполнение массива случайными числами от -100 до 100 включительно
    for (unsigned i = 0; i < n; ++i)
        for (unsigned j = 0; j < m; ++j){
            matrix[i][j] = 1.0 * rand() / RAND_MAX * 200 - 100;
    }


    printf("Исходные значения:\n");
    // todo: вынести алгоритм вывода в функцию
    // вывод значений на экран в отдельном цикле, т.к. его в дальнейшем будет проще перенести в отдельную функцию
    for (unsigned i = 0; i < n; ++i) {      // цикл по строкам
        for (unsigned j = 0; j < m; ++j)        // цикл по столбцам
            printf("%7.2f  ", matrix[i][j]);
        printf("\n");                           // переход на новую строку после вывода каждой строки матрицы
    }


    printf("\n");

    // вызов функции
    float max = matr_max(matrix, n, m);
    // a, n - фактические параметры;
    // каждый из них должен типом совпадать с типом соответствующего формального параметра

    printf("max = %6.2f\n", max);

    return 0;
}
```

# Пример: файлы
```c
#include <stdio.h>
#include <math.h>       // математический модуль
#include <stdlib.h>
#include <time.h>

/*
 * Автор:
 * Задача: Дан файл f, компоненты которого - целые числа x1, x2, x3, ...
 * Записать в новый файл числа, образованную по закону экспоненциального сглаживания:
 * y1 = x1, y2 = y1 * (1 - alpha) + alpha * x2 и т.д. alpha = 0.9.
 * Исходный файл может быть любого размера, в том числе превышающего размер оперативной памяти.
 * Разбить задачу на функции.
 */


/// заполняет текстовый файл с именем fname n случайными числами
void file_rand_fill(char fname[], unsigned long n){
    FILE *f = fopen(fname, "w");        // открыть файл в режиме записи; если файл уже существует, он будет перезаписан.

    for (unsigned long i = 0; i < n; ++i) {;
        fprintf(f, "%d ", rand() );
    }
    fclose(f);          // Закрытие файла, в т.ч. запись файлового буфера на диск
}

/// читает числа из файла fname_in, применяет экспоненциальное сглаживание (y1 = x1, y2 = y1 * (1 - alpha) + alpha * x2),
/// где x - входные данные, записывает результат в файл fname_out
void exp_smooth(char fname_in[], char fname_out[], float alpha){
    FILE *f_in  = fopen( fname_in, "r");        // открыть файл в режиме записи; если файл уже существует, он будет перезаписан.
    FILE *f_out = fopen( fname_out, "w");        // открыть файл в режиме записи; если файл уже существует, он будет перезаписан.
    float y, y_;
    int x;
    // первый член последовательности
    if ( !feof(f_in) ){                 // feof(f_in) вернёт true, если достигнут конец файла
        fscanf(f_in, "%d ", &x);
        y = x;
        fprintf(f_out, "%0.2f ", y);    }
    // остальные члены последовательности
    while ( !feof(f_in)){
        fscanf(f_in, "%d ", &x);
        y_ = y * (1 - alpha) + alpha * x;
        fprintf(f_out, "%0.2f ", y_);
        y = y_;
    }
    fclose(f_in); fclose(f_out);
}


int main() {

    srand( time( NULL) );                 // инициализация генератора случайных чисел текущим временем в секундах

    char file_in[] = "raw_data.txt";
    char file_out[] = "smooth_data.txt";

    // заполнение исходного файла случайными числами
    file_rand_fill(file_in, 1e8);     // 1e8 = 10^8 = 100'000'000

    // перезапись данных из первого файла во второй с преобразованием
    exp_smooth(file_in, file_out, 0.9);

    return 0;
}
```
# Ссылки
1. Задачник: https://ivtipm.github.io/Programming/Files/spisocall.htm
2. Учебник: Язык программирования С. Лекции и упражнения, Стив Прата, 6-е издание.
