# Компиляция статический библиотеки
Статическая библиотека — файл со скомпилированным исходным кодом, из которого выборочно или полностью код вставляется в программу (исполняемый файл) на этапе компоновки.

В Windows файлы статической библиотеки имеют расширение `.a`, в UNIX-подобных - `.lib`.

Статические библиотеки созданные на языке C++ как правило распространяются в паре с заголовочным файлом. Файл самой статической библиотеки -- это скомпилированный cpp файл.


Другой вид библиотек -- *динамические* (`.dll` в Windows, `.so` в UNIX-подобных ). Эти библиотеки не становятся частью исполняемого файла программы, а подключаются во время запуска или во время выполнения программы.


Исходные коды:
 - `main.cpp` -- основной файл программы
 - `random_names.h`, `random_names.cpp` -- исходные коды статический библиотеки

## Компилятор G++ (MinGW)
Подготовим заранее папку `lib` для хранения скомпилированного файла статический библиотеки.

Создание статический библиотеки:
 ```bash
g++ -c random_names.cpp -o lib/random_names.o
ar rcs lib/random_names.a lib/random_names.o
 ```
Ключ `-c` -- создать объектный файл, но не линковать. Линковка не нужна, так как статическая библиотека далее будет включена в исполняемый файл главной программы.

Статическая библиотека -- это архив из объектных файлов, который создаётся программой `ar`. `-c` -- создать архив, '-r' -- добавить новые файлы в архив (с заменой старых, если они были), `-s` -- добавить индекс объектного файла

В итоге имеем два файла библиотеки:
- `random_names.h`
- `random_names.a` -- скомпилированный cpp файл.

### Компиляция программы с включением статической библиотеки
Статическая библиотека при компиляции указывается в ряду остальных файлов исходного кода
```bash
g++ main.cpp lib/random_names.a -o main.exe
```

## Компилятор MSVC

```bash
# создание объектного файла > random_names.obj
cl /c /EHsc random_names.cpp   
# создание статический библиотеки > random_names.lib
lib random_names.obj

# компиляция программы со статической библиотекой > main.exe
cl main.cpp random_names.obj   
```
- `/c` -- компиляция без линковки
- `/EHsc` -- настройки обработки исключений [https://docs.microsoft.com/en-us/cpp/build/reference/eh-exception-handling-model?view=msvc-160]

## В IDE
### Создание статической библиотеки в Qt Creator
Шаблон проекта: Бибблиотека | С++ библиотека > ... > Project Details:
   type = static library
   Qt module = None (если не будут использоваться библиотеки Qt)

По умолчанию создаются заголовочный файл с заготовкой класса. Этот код можно убрать.


### Подключение статической библиотеки в Qt Creator
ПКМ на проекте > Add library > Выбрать "Внешняя библиотека" > Выбрать lib файл и папку с .h файлом

См. как изменится .pro файл после добавления библиотеки

### Подключение статической библиотеки в VisualStudio
1. Добавить пусть к заголовочнуму файлу библиотеки (если не в папке проекта): Project Properties > C/C++ > General > Additional Include Directories

1. Указать файл статической библиотеки (.lib в Windows): Project Properties > Linker > Input



# Дополнительно
-  Создание и подключение статической библиотеки в Visual Studio: https://docs.microsoft.com/ru-ru/cpp/build/walkthrough-creating-and-using-a-static-library-cpp?view=msvc-160
- Список ключей компилятора MSVC: https://docs.microsoft.com/en-us/cpp/build/reference/compiler-options-listed-by-category?view=msvc-160
