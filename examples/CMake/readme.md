# Система сборки CMake

Для компиляции простых программ достаточно вызывать только команду компиляции, например:
```bash
g++ main.cpp unit.cpp -o my_program 
```
Более сложные программы обычно полагаются на внешние библиотеки, наборы дополнительных файлов (файлы с данными, файлы настроек, изображения и т.д.).
Иногда такие программы компилируют частями, разбивая их на отдельные модули. 
Таким образом, процесс компиляции может включать в себя несколько запусков компилятора с различными файлами и настройками, 
с учётом расположения ранее скомпилированных частей программы, очистку папок от временных файлов, 
копирование уже готовой программы и её файлов в отдельный, от файлов исходного кода, каталог.

**Система автоматизации сборки** -- набор программ, призванных упростить компиляцию кода, с учётом параметров компилятора, 
зависимостей кода (других библиотек), выполнения модульных тестов, очистки проекта от временных файлов и т.п. 
Система сборки полагается на специальные конфигурационные файлы, которые описывают состав проекта и процесс его компиляции. 
Большинство современных IDE при компиляции программы не вызывают компилятор напрямую, а обращаются к системе сборки. 
Например Qt Creator и CLion полагаются на CMake.

**CMake** -- система сборки, которая позволяет автоматизировать компиляцию программ (сконфигурировать команду компиляции), 
выполнение тестов, развёртывание программы и т.п. Конфигурация сборки описывается в файле CMakeLists.txt

Рассмотрим простую программу **main.cpp**
```C++
#include <iostream>
using namespace std;

int main(){
	cout << "Hello, World\n"; }
```
Создадим простой файл конфигурации сборки `CMakeLists.txt`
```cmake
# add_executable -- цель -- создание исполняемого файла
add_executable(                         
  ${PROJECT_NAME}                        # имя файла = имя проекта
  main.cpp                               # Список файлов исходного кода
)
```

**Сборка**
Структура проекта:
```bash
my_project
--src
----main.cpp
----CMakeLists.txt
```

Подготовка сборки, временные файлы сборки и исполняемый файл будут сохранены в папку build, находящуюся на одном уровне с папкой src
```bash
cmake -B ../my_build .
```
Сборка:
```bash
cmake --build ../my_build 
```

В результате получится структура проекта
```bash
my_project
--src
----main.cpp
----CMakeLists.txt
--my_build
---- ...служебные файлы и папки ...
---- my_project.exe
```



Более сложный файл конфигурации сборки `CMakeLists.txt`
```cmake
# требуемая версия CMake
cmake_minimum_required(VERSION 3.24)

# название проекта my_project и его версия
project(my_project VERSION 1.5)

# настроки компилятора
set(CMAKE_CXX_COMPILER "g++-12")         # имя компилятора (можно указать полный путь)
set(CMAKE_CXX_STANDARD 20)               # версия стандарта языка
# set(CMAKE_CXX_STANDARD_REQUIRED True)  # включает проверку: задана ли явно версия стандарта языка
add_compile_options(-O2)                 # другие опции компиляции


# папка для сохранения исполняемого файла
# стоит указать, чтобы отделить от служебных файлов генерируемых CMake
set (CMAKE_RUNTIME_OUTPUT_DIRECTORY bin)

# add_executable -- цель -- создание исполняемого файла
add_executable(                         
  ${PROJECT_NAME}                        # имя файла = имя проекта
  main.cpp                               # Список файлов исходного кода
)
```
